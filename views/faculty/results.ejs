<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/dashboard.css" rel="stylesheet">
</head>
<body class="dashboard-body">
    
    <!-- Top Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary-custom fixed-top">
        <div class="container-fluid">
            <div class="d-flex align-items-center">
                <button class="btn btn-outline-light d-lg-none me-2" type="button" id="sidebarToggle">
                    <i class="bi bi-list"></i>
                </button>
                <a class="navbar-brand d-flex align-items-center" href="/faculty/dashboard">
                    <i class="bi bi-mortarboard me-2 text-white" style="font-size: 1.5rem;"></i>
                    <span class="fw-bold">Lab Exam Portal</span>
                </a>
            </div>
            
            <!-- User Menu -->
            <div class="dropdown">
                <a class="nav-link dropdown-toggle d-flex align-items-center text-white" 
                   href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                    <img src="<%= user.profileImage || '/images/default-avatar.png' %>" 
                         alt="Avatar" width="32" height="32" class="rounded-circle me-2" id="navbarAvatar">
                    <span class="d-none d-sm-inline">
                        <%= user.firstName %> <%= user.lastName %>
                    </span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                        <div class="dropdown-header">
                            <strong><%= user.firstName %> <%= user.lastName %></strong><br>
                            <small class="text-muted"><%= user.email %></small><br>
                            <span class="badge bg-success">Faculty</span>
                        </div>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="/faculty/settings">
                        <i class="bi bi-gear me-2"></i>Settings
                    </a></li>
                    <li><a class="dropdown-item" href="#" onclick="confirmLogout()">
                        <i class="bi bi-box-arrow-right me-2"></i>Logout
                    </a></li>
                </ul>
            </div>
        </div>
    </nav>
    
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h5 class="text-white mb-0">Faculty Portal</h5>
            <small class="text-white-50">Teaching Dashboard</small>
        </div>
        
        <ul class="sidebar-nav">
            <li class="nav-item">
                <a class="nav-link" href="/faculty/dashboard">
                    <i class="bi bi-speedometer2"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/faculty/attendance">
                    <i class="bi bi-clipboard-check"></i>
                    <span>Attendance</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/faculty/grading">
                    <i class="bi bi-journal-text"></i>
                    <span>Grading</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" href="/faculty/results">
                    <i class="bi bi-bar-chart-line"></i>
                    <span>Results & Reports</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/faculty/students">
                    <i class="bi bi-people"></i>
                    <span>Student Management</span>
                </a>
            </li>
        </ul>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="content-wrapper">
            
            <!-- Page Header -->
            <div class="page-header">
                <div class="row align-items-center">
                    <div class="col">
                        <h1 class="page-title">
                            <i class="bi bi-bar-chart-line me-2"></i>
                            Results & Reports
                        </h1>
                        <p class="page-subtitle">Analyze student performance and export comprehensive results</p>
                    </div>
                    <div class="col-auto">
                        <div class="d-flex gap-2">
                            <% if (selectedClass) { %>
                                <button class="btn btn-success btn-sm" onclick="exportToCSV()">
                                    <i class="bi bi-download me-1"></i>
                                    Export CSV
                                </button>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Filters and Controls -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card card-custom">
                        <div class="card-body py-3">
                            <form method="GET" id="resultsForm">
                                <div class="row align-items-end">
                                    <div class="col-md-6">
                                        <label class="form-label">Select Class</label>
                                        <select class="form-select" name="classId" onchange="this.form.submit()">
                                            <option value="">Choose a class to view results...</option>
                                            <% classes.forEach(cls => { %>
                                                <option value="<%= cls._id %>" <%= selectedClass && selectedClass._id.equals(cls._id) ? 'selected' : '' %>>
                                                    <%= cls.className %> (<%= cls.classCode %>) - Sem <%= cls.semester %>
                                                </option>
                                            <% }); %>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Filter Status</label>
                                        <select class="form-select" name="status" onchange="this.form.submit()">
                                            <option value="all" <%= selectedStatus === 'all' ? 'selected' : '' %>>All Students</option>
                                            <option value="pass" <%= selectedStatus === 'pass' ? 'selected' : '' %>>Pass Only</option>
                                            <option value="fail" <%= selectedStatus === 'fail' ? 'selected' : '' %>>Fail Only</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <% if (selectedClass) { %>
                                            <button type="button" class="btn btn-info btn-sm" onclick="refreshStats()">
                                                <i class="bi bi-arrow-clockwise me-1"></i>Refresh
                                            </button>
                                        <% } %>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Results Content -->
            <% if (selectedClass && results.length > 0) { %>
                
                <!-- Class Statistics -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card card-custom">
                            <div class="card-header bg-success bg-opacity-10">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h5 class="mb-1 text-success">
                                            <i class="bi bi-graph-up me-2"></i>
                                            Class Performance Analysis - <%= selectedClass.className %>
                                        </h5>
                                        <small class="text-muted">
                                            <%= selectedClass.subject %> • <%= selectedClass.classCode %> • Semester <%= selectedClass.semester %>
                                        </small>
                                    </div>
                                    <div class="col-md-4 text-md-end">
                                        <div class="class-grade-summary">
                                            <span class="average-score">
                                                Class Average: <strong><%= classStats.avgPercentage %>%</strong>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <!-- Statistics Cards -->
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <div class="stat-box">
                                                    <div class="stat-icon bg-primary">
                                                        <i class="bi bi-people-fill"></i>
                                                    </div>
                                                    <div class="stat-info">
                                                        <h4><%= classStats.totalStudents %></h4>
                                                        <p>Total Students</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <div class="stat-box">
                                                    <div class="stat-icon bg-success">
                                                        <i class="bi bi-check-circle-fill"></i>
                                                    </div>
                                                    <div class="stat-info">
                                                        <h4><%= classStats.passedStudents %></h4>
                                                        <p>Passed</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <div class="stat-box">
                                                    <div class="stat-icon bg-danger">
                                                        <i class="bi bi-x-circle-fill"></i>
                                                    </div>
                                                    <div class="stat-info">
                                                        <h4><%= classStats.failedStudents %></h4>
                                                        <p>Failed</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <div class="stat-box">
                                                    <div class="stat-icon bg-info">
                                                        <i class="bi bi-percent"></i>
                                                    </div>
                                                    <div class="stat-info">
                                                        <h4><%= classStats.passPercentage %>%</h4>
                                                        <p>Pass Rate</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <!-- Grade Distribution Chart - MORE SPACE -->
                                        <div class="grade-distribution">
                                            <h6 class="mb-4 text-center">Grade Distribution</h6>
                                            <div class="grade-bars">
                                                <% 
                                                const gradeCount = {};
                                                ['A+', 'A', 'B+', 'B', 'C+', 'C', 'D', 'F'].forEach(grade => {
                                                    gradeCount[grade] = results.filter(r => r.letterGrade === grade).length;
                                                });
                                                %>
                                                <% Object.entries(gradeCount).forEach(([grade, count]) => { %>
                                                    <% if (count > 0) { %>
                                                        <div class="grade-bar-item mb-3">
                                                            <div class="grade-bar-label d-flex justify-content-between align-items-center mb-2">
                                                                <span class="grade-badge grade-<%= grade.replace('+', 'plus') %>"><%= grade %></span>
                                                                <span class="grade-count fw-bold"><%= count %> students</span>
                                                            </div>
                                                            <div class="grade-bar">
                                                                <div class="grade-bar-fill grade-<%= grade.replace('+', 'plus') %>" 
                                                                     style="width: <%= Math.round((count / classStats.totalStudents) * 100) %>%"></div>
                                                            </div>
                                                            <small class="text-muted"><%= Math.round((count / classStats.totalStudents) * 100) %>% of class</small>
                                                        </div>
                                                    <% } %>
                                                <% }); %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Top Performers -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card card-custom">
                            <div class="card-header bg-warning bg-opacity-10">
                                <h6 class="mb-0 text-warning">
                                    <i class="bi bi-trophy me-2"></i>
                                    Top 5 Performers
                                </h6>
                            </div>
                            <div class="card-body">
                                <% results.sort((a, b) => (b.percentage || 0) - (a.percentage || 0)).slice(0, 5).forEach((result, index) => { %>
                                    <div class="performer-item">
                                        <div class="d-flex align-items-center">
                                            <div class="rank-badge rank-<%= index + 1 %> me-3">
                                                #<%= index + 1 %>
                                            </div>
                                            <div class="performer-avatar me-3">
                                                <img src="<%= result.studentId.profileImage || '/images/default-avatar.png'%>" 
                                                     alt="Avatar" width="40" height="40" class="rounded-circle">
                                            </div>
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1"><%= result.studentId.firstName %> <%= result.studentId.lastName %></h6>
                                                <small class="text-muted"><%= result.studentId.email %></small>
                                            </div>
                                            <div class="text-end">
                                                <div class="performer-score">
                                                    <strong><%= result.percentage || 0 %>%</strong>
                                                </div>
                                                <% if (result.letterGrade) { %>
                                                    <span class="grade-badge grade-<%= result.letterGrade.replace('+', 'plus') %> small">
                                                        <%= result.letterGrade %>
                                                    </span>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Assessment Breakdown -->
                    <div class="col-md-6">
                        <div class="card card-custom">
                            <div class="card-header bg-info bg-opacity-10">
                                <h6 class="mb-0 text-info">
                                    <i class="bi bi-pie-chart me-2"></i>
                                    Assessment Average Breakdown
                                </h6>
                            </div>
                            <div class="card-body">
                                <% 
                                // Calculate average for each assessment type
                                const totalResults = results.length;
                                const avgCIA = totalResults > 0 ? Math.round(results.reduce((sum, r) => sum + (r.ciaTotal || 0), 0) / totalResults) : 0;
                                const avgESE = totalResults > 0 ? Math.round(results.reduce((sum, r) => sum + (r.eseTotal || 0), 0) / totalResults) : 0;
                                const avgPractical = totalResults > 0 ? Math.round(results.reduce((sum, r) => sum + (r.practicalTotal || 0), 0) / totalResults) : 0;
                                %>
                                <div class="assessment-avg-breakdown">
                                    <div class="assessment-avg-item">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span>CIA Assessment</span>
                                            <strong><%= avgCIA %>/40</strong>
                                        </div>
                                        <div class="progress">
                                            <div class="progress-bar bg-warning" style="width: <%= (avgCIA / 40) * 100 %>%"></div>
                                        </div>
                                        <small class="text-muted">Average: <%= Math.round((avgCIA / 40) * 100) %>%</small>
                                    </div>
                                    
                                    <div class="assessment-avg-item">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span>ESE Assessment</span>
                                            <strong><%= avgESE %>/50</strong>
                                        </div>
                                        <div class="progress">
                                            <div class="progress-bar bg-danger" style="width: <%= (avgESE / 50) * 100 %>%"></div>
                                        </div>
                                        <small class="text-muted">Average: <%= Math.round((avgESE / 50) * 100) %>%</small>
                                    </div>
                                    
                                    <div class="assessment-avg-item">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span>Practical Assessment</span>
                                            <strong><%= avgPractical %>/10</strong>
                                        </div>
                                        <div class="progress">
                                            <div class="progress-bar bg-success" style="width: <%= (avgPractical / 10) * 100 %>%"></div>
                                        </div>
                                        <small class="text-muted">Average: <%= Math.round((avgPractical / 10) * 100) %>%</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Detailed Results Table -->
                <div class="row">
                    <div class="col-12">
                        <div class="card card-custom">
                            <div class="card-header">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h5 class="mb-0">
                                            <i class="bi bi-table me-2"></i>
                                            Detailed Student Results
                                        </h5>
                                    </div>
                                    <div class="col-auto">
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="sortResults('name')">
                                                <i class="bi bi-sort-alpha-down"></i> Name
                                            </button>
                                            <button class="btn btn-outline-primary" onclick="sortResults('percentage')">
                                                <i class="bi bi-sort-numeric-down"></i> Score
                                            </button>
                                            <button class="btn btn-outline-primary" onclick="sortResults('grade')">
                                                <i class="bi bi-sort-down"></i> Grade
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0" id="resultsTable">
                                        <thead class="table-light">
                                            <tr>
                                                <th width="40">#</th>
                                                <th>Student Details</th>
                                                <th width="80">CIA<br><small>/40</small></th>
                                                <th width="80">ESE<br><small>/50</small></th>
                                                <th width="80">Practical<br><small>/10</small></th>
                                                <th width="80">Total<br><small>/100</small></th>
                                                <th width="80">Grade</th>
                                                <th width="80">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% results.forEach((result, index) => { %>
                                                <tr class="result-row <%= result.status === 'Fail' ? 'table-danger-subtle' : 'table-success-subtle' %>">
                                                    <td><%= index + 1 %></td>
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            <img src="<%= result.studentId.profileImage || '/images/default-avatar.png'%>" 
                                                                 alt="Avatar" width="35" height="35" class="rounded-circle me-2">
                                                            <div>
                                                                <h6 class="mb-0"><%= result.studentId.firstName %> <%= result.studentId.lastName %></h6>
                                                                <small class="text-muted"><%= result.studentId.email %></small>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="text-center">
                                                        <span class="score-badge cia-score">
                                                            <%= result.ciaTotal || 0 %>
                                                        </span>
                                                    </td>
                                                    <td class="text-center">
                                                        <span class="score-badge ese-score">
                                                            <%= result.eseTotal || 0 %>
                                                        </span>
                                                    </td>
                                                    <td class="text-center">
                                                        <span class="score-badge practical-score">
                                                            <%= result.practicalTotal || 0 %>
                                                        </span>
                                                    </td>
                                                    <td class="text-center">
                                                        <strong class="total-score">
                                                            <%= result.totalMarks || 0 %>
                                                        </strong>
                                                        <br>
                                                        <small class="text-muted">(<%= result.percentage || 0 %>%)</small>
                                                    </td>
                                                    <td class="text-center">
                                                        <% if (result.letterGrade) { %>
                                                            <span class="grade-badge grade-<%= result.letterGrade.replace('+', 'plus') %>">
                                                                <%= result.letterGrade %>
                                                            </span>
                                                        <% } else { %>
                                                            <span class="badge bg-secondary">-</span>
                                                        <% } %>
                                                    </td>
                                                    <td class="text-center">
                                                        <span class="badge bg-<%= result.status === 'Pass' ? 'success' : 'danger' %>">
                                                            <%= result.status || 'Pending' %>
                                                        </span>
                                                    </td>
                                                </tr>
                                            <% }); %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <small class="text-muted">
                                            Showing <%= results.length %> student(s) • 
                                            Last updated: <%= new Date().toLocaleDateString() %>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            <% } else if (selectedClass && results.length === 0) { %>
                
                <!-- No Results -->
                <div class="row">
                    <div class="col-12">
                        <div class="card card-custom">
                            <div class="card-body text-center py-5">
                                <i class="bi bi-bar-chart text-muted" style="font-size: 4rem;"></i>
                                <h4 class="mt-4 text-muted">No Results Available</h4>
                                <p class="text-muted mb-4">
                                    There are no graded results for this class yet.<br>
                                    Start by grading your students' assessments.
                                </p>
                                <a href="/faculty/grading?classId=<%= selectedClass._id %>" class="btn btn-primary">
                                    <i class="bi bi-journal-text me-2"></i>
                                    Start Grading
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
            <% } else { %>
                
                <!-- No Class Selected -->
                <div class="row">
                    <div class="col-12">
                        <div class="card card-custom">
                            <div class="card-body text-center py-5">
                                <i class="bi bi-bar-chart-line text-muted" style="font-size: 4rem;"></i>
                                <h4 class="mt-4 text-muted">Select a Class</h4>
                                <p class="text-muted mb-4">
                                    Choose a class from the dropdown above to view detailed results and analytics.
                                </p>
                                <% if (classes.length === 0) { %>
                                    <div class="alert alert-warning">
                                        <i class="bi bi-exclamation-triangle me-2"></i>
                                        You don't have any assigned classes yet. Contact the administrator to assign classes.
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
                
            <% } %>
            
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/dashboard.js"></script>
    
    <script>
        // Logout confirmation
        function confirmLogout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '/auth/logout';
            }
        }
        
        // Sidebar toggle
        document.getElementById('sidebarToggle')?.addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('show');
        });
        
        // Sort results table
        function sortResults(criteria) {
            const table = document.getElementById('resultsTable');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            rows.sort((a, b) => {
                switch (criteria) {
                    case 'name':
                        const nameA = a.querySelector('h6').textContent.trim();
                        const nameB = b.querySelector('h6').textContent.trim();
                        return nameA.localeCompare(nameB);
                        
                    case 'percentage':
                        const scoreA = parseInt(a.querySelector('.total-score').textContent) || 0;
                        const scoreB = parseInt(b.querySelector('.total-score').textContent) || 0;
                        return scoreB - scoreA; // Descending
                        
                    case 'grade':
                        const gradeOrder = {'A+': 10, 'A': 9, 'B+': 8, 'B': 7, 'C+': 6, 'C': 5, 'D': 4, 'F': 0};
                        const gradeA = a.querySelector('.grade-badge')?.textContent.trim() || '';
                        const gradeB = b.querySelector('.grade-badge')?.textContent.trim() || '';
                        return (gradeOrder[gradeB] || 0) - (gradeOrder[gradeA] || 0);
                        
                    default:
                        return 0;
                }
            });
            
            // Re-append sorted rows
            rows.forEach((row, index) => {
                row.querySelector('td:first-child').textContent = index + 1; // Update rank
                tbody.appendChild(row);
            });
            
            showToast(`Sorted by ${criteria}`, 'info');
        }
        
        // Export to CSV
        function exportToCSV() {
            const table = document.getElementById('resultsTable');
            if (!table) return;
            
            let csv = 'Student Name,Email,CIA,ESE,Practical,Total,Percentage,Grade,Status\n';
            
            table.querySelectorAll('tbody tr').forEach(row => {
                const cells = row.querySelectorAll('td');
                const name = cells[1].querySelector('h6').textContent.trim();
                const email = cells[1].querySelector('small').textContent.trim();
                const cia = cells[2].textContent.trim();
                const ese = cells[3].textContent.trim();
                const practical = cells[4].textContent.trim();
                const total = cells[5].querySelector('.total-score').textContent.trim();
                const percentage = cells[5].querySelector('small').textContent.trim().replace(/[()%]/g, '');
                const grade = cells[6].textContent.trim();
                const status = cells[7].textContent.trim();
                
                csv += `"${name}","${email}",${cia},${ese},${practical},${total},${percentage},"${grade}","${status}"\n`;
            });
            
            // Download CSV
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `<%= selectedClass ? selectedClass.classCode : 'class' %>_results_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showToast('CSV file downloaded!', 'success');
        }
        
        // Refresh statistics
        function refreshStats() {
            window.location.reload();
        }
        
        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            toast.style.cssText = `
                top: 80px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            `;
            
            const iconMap = {
                success: 'bi-check-circle',
                danger: 'bi-exclamation-triangle',
                warning: 'bi-exclamation-triangle',
                info: 'bi-info-circle'
            };
            
            toast.innerHTML = `
                <i class="bi ${iconMap[type] || 'bi-info-circle'} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                const bsAlert = new bootstrap.Alert(toast);
                bsAlert.close();
            }, type === 'success' ? 4000 : 3000);
        }
        
        // Initialize animations
        document.addEventListener('DOMContentLoaded', function() {
            // Animate stat boxes
            document.querySelectorAll('.stat-box').forEach((box, index) => {
                box.style.opacity = '0';
                box.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    box.style.transition = 'all 0.4s ease';
                    box.style.opacity = '1';
                    box.style.transform = 'translateY(0)';
                }, 100 + (index * 100));
            });
            
            // Animate table rows
            document.querySelectorAll('.result-row').forEach((row, index) => {
                row.style.opacity = '0';
                row.style.transform = 'translateX(20px)';
                
                setTimeout(() => {
                    row.style.transition = 'all 0.3s ease';
                    row.style.opacity = '1';
                    row.style.transform = 'translateX(0)';
                }, 200 + (index * 50));
            });
        });
    </script>
    
</body>
</html>
